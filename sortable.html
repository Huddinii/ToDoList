<!doctype html>
<html lang="en">

<head>
    <script src="/js/htmx.js"></script>
</head>
<body>
    <div class="c content ">
        <script src="https://unpkg.com/sinon@9.0.2/pkg/sinon.js"></script>
        <script src="/js/demo.js"></script>
        <div id="demo-server-info">
            <div id="demo-activity" class="row">
                <div class="3 col">
                    <ol id="demo-timeline" reversed>
                    </ol>
                </div>
                <div id="demo-current-request" class="9 col">
                </div>
            </div>
        </div>
        
        <div id="demo-canvas">
        </div>
        <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
        <script>

            //=========================================================================
            // Fake Server Side Code
            //=========================================================================
            htmx.onLoad(function (content) {
                var sortables = content.querySelectorAll(".sortable");
                for (var i = 0; i < sortables.length; i++) {
                    var sortable = sortables[i];
                    var sortableInstance = new Sortable(sortable, {
                        animation: 150,
                        ghostClass: 'blue-background-class',

                        // Make the `.htmx-indicator` unsortable
                        filter: ".htmx-indicator",
                        onMove: function (evt) {
                            return evt.related.className.indexOf('htmx-indicator') === -1;
                        },

                        // Disable sorting on the `end` event
                        onEnd: function (evt) {
                            this.option("disabled", true);
                        }
                    });

                    // Re-enable sorting on the `htmx:afterSwap` event
                    sortable.addEventListener("htmx:afterSwap", function () {
                        sortableInstance.option("disabled", false);
                    });
                }
            })

            // var listItems = [1, 2, 3, 4, 5]
            // // routes
            // init("/demo", function (request, params) {
            //     return '<form id="example1" class="list-group col sortable" hx-post="/items" hx-trigger="end">' +
            //         listContents()
            //         + "\n</form>";
            // });

            onPost("/items", function (request, params) {
                console.log(params);
                listItems = params.item;
                // return listContents();
            });

            // // templates
            // function listContents() {
            //     return '<div class="htmx-indicator" style="cursor: default">Updating...</div>' + listItems.map(function (val) {
            //         return `  <div style="border:1px solid #DEDEDE; padding:12px; margin: 8px; width:200px; cursor: grab" ondrag="this.style.cursor = 'grabbing'" ><input type="hidden" name="item" value="` + val + `"/> Item ` + val + `</div>`;
            //     }).join("\n");
            // }
        </script>
    </div>
    <form  id="example1" class="list-group col sortable" hx-post="/items" hx-trigger="end">
        <div style="border:1px solid #DEDEDE; padding:12px; margin: 8px; width:200px; cursor: grab" 
        ondrag="this.style.cursor = 'grabbing'" ><input type="hidden" name="item" value="10"/> Item 10</div>
        <div style="border:1px solid #DEDEDE; padding:12px; margin: 8px; width:200px; cursor: grab" 
        ondrag="this.style.cursor = 'grabbing'" ><input type="hidden" name="item" value="11"/> Item 11</div>

    </form>
</body>

</html>